<script>
    import { svgPosition, cursor } from '/src/stores.ts';
    import { get } from 'svelte/store';
    import { tweened } from 'svelte/motion';
    import { cubicOut } from 'svelte/easing';
	import { onDestroy, onMount } from 'svelte';

    import Flower from '$lib/assets/testflower-01.svg';

    const svgSize = { width: 50, height: 50 }; // dimensions of the SVG
    const repelDistance = 100; // distance to start repelling
    const smoothingFactor = 0.1; // smoothing factor for interpolation

    // Initialize an interpolated store for the SVG position
    const smoothSvgPosition = tweened({ x: 200, y: 200 }, { duration: 750, easing: cubicOut });

    function handleMouseMove(event) {
        cursor.set({ x: event.clientX, y: event.clientY });

        const cursorPos = get(cursor);
        const position = get(svgPosition);

        // Calculate the center of the SVG
        const svgCenterX = position.x + svgSize.width / 2;
        const svgCenterY = position.y + svgSize.height / 2;

        const dx = cursorPos.x - svgCenterX;
        const dy = cursorPos.y - svgCenterY;
        const distance = Math.sqrt(dx * dx + dy * dy);

        if (distance < repelDistance) {
            const angle = Math.atan2(dy, dx);
            // const repelForce = repelDistance - distance;
            const repelForce = 5;

            const newX = position.x - Math.cos(angle) * repelForce * smoothingFactor;
            const newY = position.y - Math.sin(angle) * repelForce * smoothingFactor;

            const clampedX = Math.max(Math.min(newX, window.innerWidth - svgSize.width), 0);
            const clampedY = Math.max(Math.min(newY, window.innerHeight - svgSize.height), 0);

            svgPosition.set({
                x: clampedX,
                y: clampedY
            });

            // Update the smooth position
            smoothSvgPosition.set({
                x: clampedX,
                y: clampedY
            });
        }
    }
</script>

<style>
    svg, img {
        position: absolute;
        top: 0;
        left: 0;
        transform: translateX(var(--x)) translateY(var(--y));
    }
</style>

<svelte:window on:mousemove={handleMouseMove} />

{#if $smoothSvgPosition}
    <!-- <svg
        width="50"
        height="50"
        xmlns="http://www.w3.org/2000/svg"
        viewBox="0 0 24 24"
        fill="none"
        stroke="currentColor"
        stroke-width="2"
        stroke-linecap="round"
        stroke-linejoin="round"
        style="--x: {$svgPosition.x}px; --y: {$svgPosition.y}px;"
    >
        <circle cx="12" cy="12" r="10"></circle>
    </svg> -->
    <!-- viewBox="0 0 541.77 303.96" -->
    <!-- <svg width={svgSize.width} height={svgSize.height} style="--x: {$smoothSvgPosition.x}px; --y: {$smoothSvgPosition.y}px;" id="Layer_2" data-name="Layer 2" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 541.77 541.77">
        <path width="100%" height="100%" fill="#30190a" stroke-width="0px" d="m329,85.01c-1.52-2.19-2.54-4.34-4.62-5.41-2.41-1.23-4.88-2.14-6.91-2.68-2.84-.75-5.66-1.8-8.33-1.84-2.91-.05-5.86.48-8.49,1-2.9.58-5.5,2.03-7.93,2.95-3,1.13-5.91,1.74-7.98,2.75-2.43,1.19-5.08,2.66-7.69,4.31-2.37,1.5-4.98,3.04-7.34,4.87s-4.06,4.27-6.19,6.29-4.16,4.15-6,6.38-2.51,5.35-3.97,7.81-3.94,4.59-4.85,7.29c-.94,2.79-2.27,5.72-2.4,8.61-.07,1.46,1.12,8.15-.44,8.45-1.15.22-2.32-3.82-4.51-7.51-1.15-1.95-3.16-3.71-5.11-5.9-3.18-3.56-7.03-6.1-9.45-7.47,2.13-1.78,5.51-4.58,8.41-7.85,2.17-2.43,5.37-4.62,7.52-7.94,1.69-2.62,3.29-5.32,4.55-7.96,1.34-2.82.73-6.31,1.64-9.09.97-2.97,3.66-5.41,4.22-8.27.6-3.09-.68-6.35-.45-9.23.25-3.2.05-6.17-.04-8.98-.1-3.37-.63-6.3-.99-8.9-.6-4.41-.52-7.64-.87-8.97-.77-2.95-1.76-5.93-2.85-9.02-1.01-2.87-1.4-6.19-3.13-9.02-1.55-2.54-3.9-4.77-6.34-7.16-2.45-2.41-4.7-4.99-7.36-6.56-2.95-1.74-6.34-2.4-9.28-3.35-3.36-1.08-6.63-1.56-9.55-1.94-4.1-.54-7.53.26-9.72.24-1.63-.01-4.62-.39-8.53.05-2.53.28-5.3.83-8.37,1.64-2.61.68-5.82.28-8.6,1.51-2.51,1.11-4.93,2.88-7.43,4.55-2.29,1.53-3.69,4.27-5.86,6.37-2,1.93-5.23,2.6-6.7,4.58-1.71,2.28-1.63,5.49-2.75,7.59-1.45,2.74-3.01,5.51-3.71,7.48-1.54-1.7-3.96-3.87-6.39-5.96-1.92-1.64-4.12-3.21-6.62-4.85-1.41-.92-4.32-2.46-8.32-4.38-2.52-1.21-4.67-4.6-8.03-5.64-2.83-.88-6.18-1.4-9.52-1.87-2.99-.42-6.35-.6-9.68-.48-2.94.1-5.54,2.43-8.23,2.93-2.89.53-5.73.56-8.32,1.43-2.8.95-5.39,2.04-7.81,3.25-2.69,1.34-5.6,2.04-7.81,3.51-2.62,1.74-4.54,4.02-6.45,5.63-2.95,2.49-4.31,5.33-5.47,6.52-1.2,1.23-4.94,2.4-7.63,5.74-1.75,2.17-2.14,5.78-3.96,8.66-1.58,2.51-3.6,4.9-4.93,7.87-1.24,2.78-3.15,5.46-3.93,8.56s-2.02,6.15-2.13,9.34c-.1,3.02.73,6.33,1.38,9.51.65,3.16,2.54,5.75,3.65,8.22,1.42,3.16,2.15,5.49,3.54,7.44-2.8.94-5.81,2.48-9.76,4.63-2.99,1.63-6.88,2.89-10.08,5.48-.98.79-3.59,3.65-6.98,7.47-1.94,2.18-2.67,5.89-4.72,9.01-1.72,2.61-3.97,5.11-5.44,8.35-1.32,2.91-2.37,6.04-3.27,9.43-.82,3.1-.72,6.4-1.03,9.89C2.44,157.04-.03,159.85,0,162.92c.02,2.73.49,5.81,1.18,8.74.62,2.63,2.44,5.15,3.93,7.83,1.45,2.62,2.85,5.21,4.88,7.15s4.84,2.83,7.47,4.33c2.3,1.32,4.84,2.47,7.69,3.67,2.44,1.03,5.36,1.28,8.25,2.34,2.51.92,5.05,2.26,7.93,3.27,2.9,1.03,5.26,3.09,7.91,3.93,2.89.92,5.99.36,8.76.93s5.51,3.05,8.45,3.11c2.79.06,5.79-.73,8.83-1.29,3.47-.64,6.19-2.92,8.92-4.02,3.54-1.43,6.77-2.58,8.95-3.99,1.98,2,5.49,3.99,9.52,6.49,1.01.63,3.58,3.93,8.29,5.69,2.79,1.04,6.09,2.49,9.7,3.03,3.14.47,6.66-.04,10.16-.41,3.11-.33,5.46-2.14,8.03-3.13s5.07-2.15,7.62-3.74c2.3-1.42,4.52-3.17,7.1-4.92,2.64-1.78,5.02-3.59,7.35-5.11,2.7-1.77,6.18-1.85,8.49-3.31,2.79-1.75,4.36-4.87,6.66-6.24,2.93-1.74,6.72-1.06,8.97-2.31,3.13-1.75,5.25-3.87,7.41-5.03,3.19-1.72,6.15-2.3,8.24-3.89s4-3.89,6.27-6.73c1.57-1.97,2.62-5.14,4.5-8.31,1.42-2.4,3.81-4.76,5.17-7.91,1.14-2.64.3-6.26,1.26-9.47.83-2.8,1.6-5.7,2.21-8.96.54-2.89,1.82-5.91,2.13-9.18,1.53,1.94,3.17,4.6,4.96,7.5,1.42,2.3,2.39,5.09,3.74,8,1.18,2.53,3.54,4.77,4.51,7.75,1.08,3.3,0,6.84.55,9.81.63,3.43,2.06,6.42,2.22,9.41.19,3.54.51,6.77.46,9.69-.03,1.65.3,4.52-.06,8.25-.23,2.36-.41,5.17-.93,8.21-.42,2.49-2.94,4.76-3.63,7.62-.6,2.52-1.38,5.07-2.23,7.83-.81,2.63-1.23,5.91-2.47,9.41-1,2.81-1.04,6.31-2.46,9.51-1.25,2.81-3.26,5.46-4.93,8.46-1.51,2.72-2.72,5.82-4.65,8.61-1.78,2.58-3.74,5.23-5.92,7.81-2.03,2.4-4.91,4.16-7.33,6.52-2.5,2.44-5.14,4.45-7.65,6.46-2.75,2.19-5.23,4.43-7.91,6.16-3.01,1.94-6.32,2.81-9.09,4.24-3.3,1.71-5.94,3.93-8.69,5.04-3.95,1.59-6.76,4.09-9.01,4.79-2.56.81-5.87,1.67-9.57,2.58-2.91.72-6.61-1-10.11-.5-3.07.44-6.15,2.71-9.6,2.81-3.14.09-6.42-.99-9.82-1.31-3.14-.29-6.33-.9-9.65-1.64-2.5-.56-6.08-.51-9.87-1.86-2.84-1.01-5.51-3.22-8.68-5.02-2.7-1.54-6.28-2.32-9-4.64-1.9-1.62-3.34-4.18-5.38-6.47-1.67-1.89-3.3-4.06-4.72-6.8-1.44-2.77-1.21-5.6-1.77-8.01-.72-3.11-1.07-5.72-1.31-8.06-.36-3.48-2.16-5.36-4.51-6.65-2.17-1.18-4.85-1.44-7.66-.21-2.49,1.09-4.77,2.97-6.33,5.1-2.2,2.99-1.56,6.34-1.32,9.64.28,3.97,1.02,7.55,1.86,9.83,1.18,3.19,1.41,6.76,3.18,9.33,1.92,2.78,4.33,5.23,6.61,7.36,2.51,2.34,5.52,3.96,8.04,5.64,3.1,2.07,5.53,4.65,7.88,5.92,3.06,1.66,6.48,2.52,9.47,3.7,3.25,1.29,6.43,2.6,9.53,3.43,3.4.91,6.92.74,10.05,1.23,3.55.55,6.98-.35,10.05-.16,3.8.23,7.11,2.06,9.95,2.07,2.4,0,5.71.24,9.62-.06,2.84-.22,6.11-.45,9.58-.99,2.94-.45,5.9-2.16,9.2-2.93,2.95-.69,6.11-1.25,9.3-2.24,2.93-.92,5.97-1.92,9.05-3.15,2.2-.88,5.53-1.82,9.32-3.63,2.66-1.27,5.67-2.85,8.85-4.7,2.68-1.56,5.83-2.96,8.73-4.99,2.59-1.81,4.89-4.4,7.56-6.63,2.46-2.05,4.09-5.18,6.54-7.61,2.28-2.27,5.43-3.87,7.65-6.49,0,0,1.59-2.94,4.69-7.59,1.4-2.1,3.14-4.52,4.83-7.45,1.36-2.36,2.01-5.35,3.43-8.21,1.25-2.51,4.05-4.49,5.26-7.36,1.11-2.62.62-5.99,1.64-8.9.96-2.71,1.8-5.49,2.63-8.43.79-2.78,1.98-5.49,2.62-8.46s.8-5.77,1.23-8.77,2.24-5.66,2.46-8.68-.26-5.92-.25-8.94c.01-7.03-.34-7.16-.34-7.16-.28-3.17-.4-4.33.38-5.27,1.27-1.53,4.32-.25,6.93.29,0,0,2.4.46,8.11.23,2.19-.09,4.65-1.01,7.89-1.73,3.43-.76,6.74-1.04,9.65-2.16,3.45-1.33,6.89-2,9.43-3.4,5.26-2.91,7.52-6.6,7.52-6.6,2.8-2.3,5.46-4.22,7.53-6.71,2.2-2.64,5.21-4.7,6.91-7.68s1.79-6.55,3.25-9.82c1.3-2.92,2.8-5.94,4.2-9.29,1.21-2.9,2.59-5.57,3.62-8.22,1.17-2.99,1.44-6.03,2.2-8.69.91-3.18,2.89-5.92,2.9-8.62.02-3.17-2.39-5.33-4.12-7.82Zm-162.95,23.65c-2.3-1.46-2.24-4.78-2.96-7.23-.64-2.17-1.24-4.63-3.43-6.51-2.37-2.05-5.51-3.48-8.84-3.5-2.89-.02-6.15.67-9.37,1.15-1.91.29-4.52,1.32-7.62,2.25-2.25.68-5.08.99-7.64,2.34-2.15,1.14-4.51,2.65-6.7,4.45-1.7,1.4-4.13,3.11-6.2,5.34-1.73,1.87-2.89,4.64-4.11,7.16-1.11,2.29-1.93,5-2.08,7.87-.03.66,1.07,4.06,2.42,8.32.79,2.48.91,5.7,3.02,8.11.7.79.58,1.52,1.04,1.92-.11.53-.1,7.7-5.69,9.75-6.26,2.29-12.25-4.25-12.89-4.86-2.91-2.79-4.75-6.37-5.09-10.06-.41-4.42.06-8.98.52-11.53.54-2.98,1.93-5.72,2.96-8.26,1.14-2.83,3.54-4.8,5.01-7.08,1.72-2.66,3.54-4.78,5.26-6.67,2.64-2.9,3.74-6.23,5-7.26,2.52-2.07,6.2-2.13,8.74-3.56,2.86-1.62,4.95-4.38,7.66-5.35,3.19-1.14,6.26-2.16,8.96-2.67,3.83-.72,7.11-1.21,9.25-1.35,3.04-.2,6.27.46,9.46.54s6.33.26,9.38,1.2c2.84.87,5.17,3.07,7.82,5.16,3.11,2.44,5.65,4.87,7.25,7.62,2.38,4.06,2.74,7.53,3.18,9.53-2.18,1.09-3.99,2.45-6.39,2.95-2.66.56-5.87,1.52-7.93.21Z"/>
    </svg> -->

    <img src={Flower} width={svgSize.width} height={svgSize.height} style="--x: {$smoothSvgPosition.x}px; --y: {$smoothSvgPosition.y}px;" />
{/if}
